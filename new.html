<!DOCTYPE html>
<html>

<head>
	<title></title>
	<link rel="stylesheet" href="general.css">
	<link rel="stylesheet" href="decorate.css">
	<link rel="stylesheet" href="demo.css">
	<style id="grid-css"></style>
</head>

<body>
	<div id="grid"></div>
	<script src="powergrid.umd.js"></script>	
	<script src="state.umd.js"></script>
	<script src="gridBuilder.umd.js"></script>
	<script src="defaultConfig.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	crossorigin="anonymous"></script>
	<script src="https://unpkg.com/wicked-elements"></script>
	<script src="https://cdn.jsdelivr.net/npm/custom-event-polyfill@1.0.6/polyfill.js" integrity="sha256-GgsiUYiTEQj0ldaika9Lu63JJV2XJpC7xgwuaRNpnyw=" crossorigin="anonymous"></script><!-- IE11 -->
	<script src="https://cdn.jsdelivr.net/npm/polyfill-object-assign@1.0.0/index.js" integrity="sha256-jIKadqF3tjT2cnLiHv5vFUUA54nhCN0KSE0Fnz+jmE0=" crossorigin="anonymous"></script>
	<script>
		var grid = Object.assign({
			html: '',
			dispatchEvent: function(event) {
				if (this.el && typeof this.el.dispatchEvent == 'function') {
					this.el.dispatchEvent(event);
				}
			},
			init: function (event) {	
				console.log('init')			
				this.el = event.currentTarget;
				this.updateUrl();
				var state = this.reflectState();
			
				if (!state.q) {
					state.q = window.btoa(JSON.stringify(config||{}));
				}
				this.updateState(state);
				
			},
			onhashchange: function(event) {						
				// Not needed
			},
			onpopstate: function(event) {
				this.updateState(event.state);
				console.log('popstate', event, this.state);
				
			},
			onstatechange: function() {
				this.reflectStateInUrl(this.sate)
				console.log('state', this.state);
				this.render();
			},
			render: function() {
				console.log('render');
				var config = JSON.parse(window.atob(this.state.q));
				this.html = this.createGrid($(this.el), config);	
				var css = this.createStyles(config);
				$('#grid-css').html(css);
			}
		}, gridBuilder.default || gridBuilder, state.default || state);

		// Listen to browser state changes
		window.addEventListener('hashchange', grid);
		window.addEventListener('popstate', grid);
		

		// Initialize our UI
		wickedElements.define('#grid', grid);
		
	</script>
	
</body>

</html>
