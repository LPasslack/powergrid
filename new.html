<!DOCTYPE html>
<html>

<head>
	<title></title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B"
	 crossorigin="anonymous">
	<link rel="stylesheet" href="general.css">
	<link rel="stylesheet" href="decorate.css">
	<link rel="stylesheet" href="demo.css">
	<style id="grid-css"></style>
</head>

<body>
	<div id="grid" onclick="openModal()"></div>

	<div id="menuContainer" class="pg-modal" isopen="false">
		<div class="pg-modal-content">
			<div class="pg-modal-header">

			</div>
			<div class="pg-modal-body">
				<pg-tabs-container>
					<div class="power-grid-tab-list">
						<button tab-id="gridSettingsContainer" class="tablinks active open-ui-configuration">Grid
							Settings</button>
						<button tab-id="configJSONContainer" class="tablinks show-json-editor">Config JSON</button>
						<button tab-id="sourceCodeContainer" class="tablinks show-source-code">Source Code</button>
						<button tab-id="helpContainer" class="tablinks help-tab">Help</button>
					</div>
					<div source-id="gridSettingsContainer" class="power-grid-tabcontent">
						<form class="container">
							<legend>Size</legend><hr>
							<fieldset class="row">
								<div class="form-group col-4">
									<label for="rows">Rows:</label>								
									<input class="form-control" type="number" min="1" max="99"  name="rows">
								</div>
								<div class="form-group col-4">
									<label for="cols">Cols:</label>
									<input type="number" min="1" max="99" class="form-control" name="cols">
								</div>
								<div class="form-group col-4">
									<label for="cells">Cells?</label>								
									<input class="form-control" type="number" min="1" max="99" name="cells">
								</div>
							</fieldset>
							<p class="form-group">
								<label for="track">Pick a row or col or cell to edit</label>
								<select name="track"  class="form-control"><option>...</option></select>
							</p>
						</form>
						<form id="cellCroperties">
							<div class="form-group row">
								<label for="cellText">Text:</label>
								<span class="col-sm-10"><input type="text" id="cell-text" class="form-control"></span>
							</div>
									

									<div>Cloumn Start:</div>
									<div>
										<input type="number" min="1" onlynumber id="cell-col" />
									</div>
									<div>Cloumn Span:</div>
									<div>
										<input type="number" min="1" onlynumber id="cell-col-span" />
									</div>
									<div>Row Start:</div>
									<div>
										<input type="number" min="1" onlynumber id="cell-row" />
									</div>
									<div>Row Span:</div>
									<div>
										<input type="number" min="1" onlynumber id="cell-row-span" />
									</div>
									<div>Order:</div>
									<div>
										<input type="number" min="1" onlynumber id="cell-order" />
									</div>
									<div>Align:</div>
									<div>
										<select id="cell-align">
											<option value="">--Select--</option>
											<option value="stretch">Stretch</option>
											<option value="start">Start</option>
											<option value="center">Center</option>
											<option value="end">End</option>
										</select>
									</div>
									<div>Justify:</div>
									<div>
										<select id="cell-justify">
											<option value="">--Select--</option>
											<option value="stretch">Stretch</option>
											<option value="start">Start</option>
											<option value="center">Center</option>
											<option value="end">End</option>
										</select>
									</div>
								</div>
							</p>	
						</form>
					</div>
					<div source-id="configJSONContainer" id="configJSONContainer" class="power-grid-tabcontent">
						<h3>Configure Grid using JSON </h3>
						<div id="editor-error-container"></div>
						<div class="json-editor">

						</div>
						<button class="button" onclick="saveEditedJSON()">OK</button>
					</div>
					<div source-id="sourceCodeContainer" id="sourceCodeContainer" class="power-grid-tabcontent">
						<h3>Source Code</h3>
						<pg-tabs-container>
							<div class="power-grid-tab-list">
								<button tab-id="htmlContainer" class="tablinks" id="defaultOpenTab">HTML</button>
								<button tab-id="cssContainer" class="tablinks">CSS</button>
								<button tab-id="fullSourceContainer" class="tablinks">Full Source</button>
							</div>

							<div source-id="htmlContainer" class="power-grid-tabcontent">
								<div class="power-grid-tooltip copyBtn">
									<button onclick='copyContent("html")' class="btn-action" onmouseout='tooltipOutFunc("html")'>
										<span class="power-grid-tooltiptext" id="myTooltipHtml">Copy HTML to clipboard</span>Copy
									</button>
								</div>

								<code for="htmlEg" id="showHTML" class="hljs html"></code>
							</div>

							<div source-id="cssContainer" class="power-grid-tabcontent">

								<div class="power-grid-tooltip copyBtn">
									<button onclick='copyContent("css")' class="btn-action" onmouseout='tooltipOutFunc("css")'>
										<span class="power-grid-tooltiptext" id="myTooltipCss">Copy CSS to clipboard</span>Copy
									</button>
								</div>
								<code for="grid-css" class="hljs css"></code>
							</div>

							<div source-id="fullSourceContainer" class="power-grid-tabcontent">
								<div class="power-grid-tooltip copyBtn">
									<button onclick='copyContent("full-source")' class="btn-action" onmouseout='tooltipOutFunc("full-source")'>
										<span class="power-grid-tooltiptext" id="myTooltipFullSource">Copy Source to clipboard</span>Copy
									</button>
								</div>
								<code for="full-source" class="hljs html"></code>
							</div>
						</pg-tabs-container>
						<button onclick="closeModal(this)" class="button">Close</button>
					</div>
					<div source-id="helpContainer" class="power-grid-tabcontent">
						<section>
							<div class="alerts-container"></div>
							<p class="alerts-help">There are some issues with your current configuration</p>
						</section>
						<section>
							<h3>About Powergrid</h3>
							<ul>
								<li>Version : <span id="pg-version"></span></li>
								<li><a href="https://github.com/ZS/powergrid#powergrid" target="_blank">What is Powergrid?</a></li>
								<li><a href="https://github.com/ZS/powergrid/wiki#welcome-to-the-powergrid-wiki" target="_blank">Welcome</a></li>
								<li><a href="https://github.com/ZS/powergrid/wiki/Documentation" target="_blank">Documentation</a></li>
								<li><a href="https://github.com/ZS/powergrid/issues" target="_blank">Report Issue</a></li>
								<li><a href="https://github.com/ZS/powergrid/blob/master/LICENSE" target="_blank">View License</a></li>
							</ul>
						</section>
					</div>
				</pg-tabs-container>

			</div>
		</div>
		<div class="pg-modal-footer">

		</div>
	</div>
	</div>
	<button onclick="createAlert()">Add alert</button>

	<script src="powergrid.umd.js"></script>
	<script src="state.umd.js"></script>
	<script src="gridBuilder.umd.js"></script>
	<script src="defaultConfig.js"></script>

	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	 crossorigin="anonymous"></script>

	<script src="https://unpkg.com/wicked-elements"></script>
	<script src="https://cdn.jsdelivr.net/npm/custom-event-polyfill@1.0.6/polyfill.js" integrity="sha256-GgsiUYiTEQj0ldaika9Lu63JJV2XJpC7xgwuaRNpnyw="
	 crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/polyfill-object-assign@1.0.0/index.js" integrity="sha256-jIKadqF3tjT2cnLiHv5vFUUA54nhCN0KSE0Fnz+jmE0="
	 crossorigin="anonymous"></script>
	<script src="modal.js"></script>
	<script src="alerts.js"></script>
	<script src="tabs.js"></script>
	<script>

		var grid = Object.assign({
			html: '',
			dispatchEvent: function (event) {
				if (this.el && typeof this.el.dispatchEvent == 'function') {
					this.el.dispatchEvent(event);
				}
			},
			init: function (event) {
				console.log('init')
				this.el = event.currentTarget;
				this.updateUrl();
				var state = this.reflectState();

				if (!state.q) {
					state.q = window.btoa(JSON.stringify(config || {}));
				}
				this.updateState(state);
			},
			onpopstate: function (event) {
				this.updateState(event.state);
				console.log('popstate', event, this.state);
			},
			onstatechange: function () {
				this.reflectStateInUrl(this.sate);
				config = JSON.parse(window.atob(this.state.q));				
				console.log('state', this.state);
				this.render();
			},
			update: function() {
				
			},
			render: function () {
				console.log('render');				
				this.html = this.createGrid($(this.el), config);
				var css = this.createStyles(config);				
				this.update();	
				$('#grid-css').html(css);
			}
		}, gridBuilder.default || gridBuilder, state.default || state);


		var gridEditor = {
			state: null,
			init: function(event) {
				this.el = event.target;
			},
			onconnected: function() {
				document.getElementById('grid').addEventListener('statechange', this);
			},
			onstatechange: function(event) {
				console.log('statechange', event);
				this.state = event.detail.state;
				this.render();
			},
			onchange: function(event) {
				console.log('change', event.target);
			},
			updateField: function(name, value) {
				if (!this.el) {return;}
				var fieldEl = this.el.querySelector('[name="'+name+'"]')
				if (!fieldEl) {return;}
				fieldEl.value = value;
			},
			updateSelect: function(name, optionIndex, value, label) {
				if (!this.el) {return;}
				var fieldEl = this.el.querySelector('[name="'+name+'"]');
				if (!fieldEl) {return;}
				if (!fieldEl.options[optionIndex]) {fieldEl.appendChild(document.createElement('option'))}
				fieldEl.options[optionIndex].setAttribute('value', value);
				fieldEl.options[optionIndex].innerHTML = label;
				return fieldEl;
			},
			render: function() {
				this.updateField('rows',  config.rows.length);
				this.updateField('cols',  config.cols.length);
				this.updateField('cells', config.cells.length);
				
				var selectField;
				// Update rows
				for(var i=0;i<config.rows.length; i++) {
					selectField = this.updateSelect('track', i, config.rows[i], 'row ' + (i+1));
				}
				if (selectField && this.state && this.state.row) {
					selectedField.selectedIndex[1*this.state.row];
				}

				// Update cols
				for(var j=0; j<config.cols.length; j++) {
					selectField = this.updateSelect('track', i+j, config.cols[j], 'col ' + (j+1));
				}
				if (selectField && this.state && this.state.col) {
					selectedField.selectedIndex[i-1*this.state.col];
				}
				
				// Update cells
				for(var k=0; k<config.cells.length; k++) {
					selectField = this.updateSelect('track', i+j+k, config.cells[k], 'cell ' + (k+1));
				}
				if (selectField && this.state && this.state.cell) {
					selectedField.selectedIndex[i+j-1+1*this.state.cell];
				}


				//this.updateField('');
			},
		};

		wickedElements.define('[source-id="gridSettingsContainer"]', gridEditor);
		

		// Listen to browser state changes
		window.addEventListener('hashchange', grid);
		window.addEventListener('popstate', grid);


		// Initialize our UI
		wickedElements.define('#grid', grid);



		function openModal() {
			pgModal.onClose = function () {
				console.log("%c Closing the dialog", "color:red");
			}
			pgModal.onOpen = function () {
				console.log("%c Opening the dialog", "color:blue");
			}
			document.querySelector('#menuContainer').setAttribute('isopen', 'true');
		}

		var alertCount = 1;

		function createAlert() {
			var alert = document.createElement('div');
			alert.classList.add('alert');
			alert.classList.add('alert-warning');
			document.body.appendChild(alert);

			// A bug in wicked element. AttributeChange is not triggered immediately.
			setTimeout(function () {
				alert.setAttribute('type', 'Error');
				alert.setAttribute('message', 'Error no.' + alertCount++);
			}, 0);

		}

	</script>

</body>

</html>